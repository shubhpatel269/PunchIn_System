<div class="dashboard-container">
  <!-- Header Section -->
  <div class="dashboard-header">
    <h1 class="dashboard-title"> Reports</h1>
    <div class="filters">
      <select class="filter-select" [(ngModel)]="selectedEmployee" (change)="onEmployeeChange()">
        <option *ngFor="let employee of employees" [value]="employee">{{ employee }}</option>
      </select>
      <div class="timeframe-filters">
        <button 
          *ngFor="let timeframe of timeframes" 
          class="timeframe-btn"
          [class.active]="selectedTimeframe === timeframe"
          (click)="selectedTimeframe = timeframe; onTimeframeChange()">
          {{ timeframe }}
        </button>
      </div>
    </div>
  </div>

  <!-- KPI Cards -->
  <div class="kpi-section">
    <div class="kpi-card">
      <h3>Total Working Hours</h3>
      <div class="kpi-value">{{ dashboardData.totalWorkingHours }} hrs</div>
    </div>
    <div class="kpi-card">
      <h3>Average Session Duration</h3>
      <div class="kpi-value">{{ dashboardData.averageSessionDuration }}</div>
    </div>
    <div class="kpi-card">
      <h3>Total Break Duration</h3>
      <div class="kpi-value">{{ dashboardData.totalBreakDuration }} hrs</div>
    </div>
    <div class="kpi-card">
      <h3>Overtime Hours</h3>
      <div class="kpi-value">{{ dashboardData.overtimeHours }} hrs</div>
    </div>
  </div>

  <!-- Punch-in/Punch-out Analytics -->
  <div class="analytics-section">
    <h2 class="section-title">Punch-in / Punch-out Analytics</h2>
    <div class="analytics-grid">
      <!-- Hourly Punch-in Distribution Chart -->
      <div class="chart-container">
        <h3>Hourly Punch-in Distribution</h3>
        <div class="bar-chart">
          <div class="y-axis">
            <span>30</span>
            <span>20</span>
            <span>10</span>
            <span>6</span>
            <span>0</span>
          </div>
          <div class="chart-area">
            <div 
              *ngFor="let data of dashboardData.hourlyPunchData" 
              class="bar-item">
               <div class="bar" 
                    [style.height.%]="(data.count / getMaxValue(dashboardData.hourlyPunchData, 'count')) * 100"
                    [style.min-height.px]="data.count > 0 ? 20 : 0"
                    [class.peak-bar]="data.count === getMaxValue(dashboardData.hourlyPunchData, 'count')"
                    [title]="'Hour ' + data.hour + ': ' + data.count + ' punch-ins'">
              </div>
              <span class="bar-label">{{ data.hour }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Side Metrics and Heatmap -->
      <div class="right-side-container">
        <!-- Late Arrivals & Early Exits -->
        <div class="metrics-container">
          <div class="metric-card">
            <h4>Late Arrivals</h4>
            <div class="metric-value">{{ dashboardData.lateArrivals }}</div>
          </div>
          <div class="metric-card">
            <h4>Early Exits</h4>
            <div class="metric-value">{{ dashboardData.earlyExits }}</div>
          </div>
        </div>

        <!-- Frequent Leave Days Heatmap -->
        <div class="heatmap-container">
          <h3>Frequent Leave Days</h3>
          <div class="calendar-grid">
            <div *ngFor="let day of [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]" 
                 class="calendar-day"
                 [class.filled]="day <= 15"
                 [class.medium]="day > 10 && day <= 15"
                 [class.light]="day > 5 && day <= 10">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Leave Analysis -->
  <div class="leave-analysis-section">
    <h2 class="section-title">Leave Analysis</h2>
    <div class="leave-charts">
      <!-- Leave Type Distribution -->
      <div class="chart-container">
        <h3>Leave Type Distribution</h3>
        <div class="donut-chart">
          <div class="donut-center">
            <div class="donut-total">100%</div>
          </div>
          <div class="donut-segments">
            <div *ngFor="let segment of dashboardData.leaveTypeData" 
                 class="donut-segment"
                 [style.background]="segment.color"
                 [style.transform]="'rotate(' + (segment.percentage * 3.6) + 'deg)'">
            </div>
          </div>
        </div>
        <div class="donut-legend">
          <div *ngFor="let segment of dashboardData.leaveTypeData" class="legend-item">
            <div class="legend-color" [style.background]="segment.color"></div>
            <span>{{ segment.type }}</span>
          </div>
        </div>
      </div>

      <!-- Leave Trend Over Time -->
      <div class="chart-container">
        <h3>Leave Trend Over Time</h3>
        <div class="line-chart">
          <div class="y-axis">
            <span>10</span>
            <span>8</span>
            <span>6</span>
            <span>4</span>
          </div>
          <div class="chart-area">
            <svg viewBox="0 0 480 200" class="leave-char">
              <polyline
                [attr.points]="leaveTrendPoints"
                fill="none"
                stroke="#10B981"
                stroke-width="3"
              />
            <g *ngFor="let item of dashboardData.leaveTrendData; let i = index" class="data-point">
              <circle
                [attr.cx]="i * 30 + 20"
                [attr.cy]="180 - (item.count - 4) * 15"
                r="3"
                fill="#10B981"
              />
              <text
                [attr.x]="i * 30 + 20"
                [attr.y]="195"
                text-anchor="middle"
                class="axis-label"
              >{{ item.month }}</text>
            </g>
          </svg>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Attendance Trend -->
  <div class="attendance-trend-section">
    <h2 class="section-title">Attendance Trend</h2>
    <div class="trend-charts">
      <!-- Daily Working Hours -->
      <div class="chart-container">
        <h3>Daily Working Hours</h3>
        <div class="line-chart">
          <div class="y-axis">
            <span>15</span>
            <span>10</span>
            <span>5</span>
          </div>
          <div class="chart-area">
            <svg viewBox="0 0 400 200" class="trend-chart">
              <polyline
                [attr.points]="dailyWorkingHoursPoints"
                fill="none"
                stroke="#3B82F6"
                stroke-width="2"
              />
            <g *ngFor="let item of dashboardData.dailyWorkingHoursData; let i = index" class="data-point">
              <circle
                [attr.cx]="i * 30 + 20"
                [attr.cy]="180 - (item.hours - 5) * 15"
                r="3"
                fill="#3B82F6"
              />
              <text
                [attr.x]="i * 30 + 20"
                [attr.y]="195"
                text-anchor="middle"
                class="axis-label"
              >{{ item.month }}</text>
            </g>
          </svg>
          </div>
        </div>
      </div>

      <!-- Weekly Attendance -->
      <div class="chart-container">
        <h3>Weekly Attendance</h3>
        <div class="line-chart">
          <div class="y-axis">
            <span>90</span>
            <span>60</span>
            <span>30</span>
          </div>
          <div class="chart-area">
            <svg viewBox="0 0 400 200" class="trend-chart">
              <polyline
                [attr.points]="weeklyAttendancePoints"
                fill="none"
                stroke="#3B82F6"
                stroke-width="2"
              />
            <g *ngFor="let item of dashboardData.weeklyAttendanceData; let i = index" class="data-point">
              <circle
                [attr.cx]="i * 50 + 20"
                [attr.cy]="180 - (item.hours - 30) * 2"
                r="3"
                fill="#3B82F6"
              />
              <text
                [attr.x]="i * 50 + 20"
                [attr.y]="195"
                text-anchor="middle"
                class="axis-label"
              >{{ item.day }}</text>
            </g>
          </svg>
          </div>
        </div>
      </div>

      <!-- Session Duration Trend -->
      <div class="chart-container">
        <h3>Session Duration Trend</h3>
        <div class="line-chart">
          <div class="y-axis">
            <span>30</span>
            <span>20</span>
            <span>10</span>
          </div>
          <div class="chart-area">
            <svg viewBox="0 0 400 200" class="trend-chart">
              <polyline
                [attr.points]="sessionDurationPoints"
                fill="none"
                stroke="#10B981"
                stroke-width="2"
              />
            <g *ngFor="let item of dashboardData.sessionDurationData; let i = index" class="data-point">
              <circle
                [attr.cx]="i * 50 + 20"
                [attr.cy]="180 - (item.duration - 10) * 8"
                r="3"
                fill="#10B981"
              />
              <text
                [attr.x]="i * 50 + 20"
                [attr.y]="195"
                text-anchor="middle"
                class="axis-label"
              >{{ item.day }}</text>
            </g>
          </svg>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Team Comparison -->
  <div class="team-comparison-section">
    <h2 class="section-title">Team Comparison (Optional)</h2>
    <div class="comparison-charts">
      <!-- Employee vs Team Average Breaks -->
      <div class="chart-container">
        <h3>Employee vs Team average breaks</h3>
        <div class="horizontal-bar-chart">
          <div class="bar-row">
            <span class="bar-label">Employee</span>
            <div class="bar-container">
              <div class="bar-fill" 
                   [style.width.%]="dashboardData.teamComparisonData.employeeBreaks"
                   style="background: #3B82F6;"></div>
            </div>
          </div>
          <div class="bar-row">
            <span class="bar-label">Team average breaks</span>
            <div class="bar-container">
              <div class="bar-fill" 
                   [style.width.%]="dashboardData.teamComparisonData.teamAverageBreaks"
                   style="background: #10B981;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Employee Break Duration -->
      <div class="chart-container">
        <h3>Employee break duration</h3>
        <div class="horizontal-bar-chart">
          <div class="bar-row">
            <span class="bar-label">Employee</span>
            <div class="bar-container">
              <div class="bar-fill" 
                   [style.width.%]="dashboardData.teamComparisonData.employeeBreakDuration"
                   style="background: #10B981;"></div>
            </div>
          </div>
          <div class="bar-row">
            <span class="bar-label">Team Average</span>
            <div class="bar-container">
              <div class="bar-fill" 
                   [style.width.%]="dashboardData.teamComparisonData.teamBreakDuration"
                   style="background: #3B82F6;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="dashboard-footer">
    <button class="export-btn" (click)="exportToPDF()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7,10 12,15 17,10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
      </svg>
      Export PDF
    </button>
    <div class="summary-text">
      Employee worked {{ dashboardData.totalWorkingHours }} hours this month, took 2 sick leaves.
    </div>
  </div>
</div>


